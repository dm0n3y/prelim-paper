\begin{figure}
  \judgbox{\flattenTerm{\termm^\pat}{\selection}}{$\termm^\pat$ flattens to $\selection$}
  \begin{mathpar}
    \inferrule[]{
    }{
      \flattenTerm{\term{\ophole}}{\soptile{\ophole}}
    }\hspace{20pt}
    \inferrule[]{
    }{
      \flattenTerm{\term{\svar{x}}}{\soptile{\svar{x}}}
    }\hspace{20pt}
    \inferrule[]{
      \flattenTerm{\termm^\pat}{\tiles^{\pat}}
    }{
      \flattenTerm{\term{\sparen{\termm^\pat}}}{\soptile{\sparen{\tiles^{\pat}}}}
    }\\
    \inferrule[]{
      \flattenTerm{\termm^\pat_1}{\selection_1} \\
      \flattenTerm{\termm^\pat_2}{\selection_2}
    }{
      \flattenTerm{\term{\sbinhole{\termm^\pat_1}{\termm^\pat_2}}}{\selection_1~\sbintile{\binhole}~\selection_2}
    }\hspace{20pt}
    \inferrule[]{
      \flattenTerm{\termm^\pat_1}{\selection_1} \\
      \flattenTerm{\termm^\pat_2}{\selection_2}
    }{
      \flattenTerm{\term{\sprod{\termm^\pat_1}{\termm^\pat_2}}}{\selection_1~\sbintile{\tprod}~\selection_2}
    }
  \end{mathpar}

  \vspace{10pt}
  \judgbox{\flattenTerm{\termm^\expr}{\selection}}{$\termm^\expr$ flattens to $\selection$}
  \begin{mathpar}
    \inferrule[]{
    }{
      \flattenTerm{\term{\ophole}}{\soptile{\ophole}}
    }\hspace{15pt}
    \inferrule[]{
    }{
      \flattenTerm{\term{\snumlit{n}}}{\soptile{\snumlit{n}}}
    }\hspace{15pt}
    \inferrule[]{
    }{
      \flattenTerm{\term{\svar{x}}}{\soptile{\svar{x}}}
    }\hspace{15pt}
    \inferrule[]{
      \flattenTerm{\termm^\expr}{\tiles^{\expr}}
    }{
      \flattenTerm{\term{\sparen{\termm^\expr}}}{\soptile{\sparen{\tiles^{\expr}}}}
    }\\
    \inferrule[]{
      \flattenTerm{\termm^\expr_1}{\selection_1} \\
      \flattenTerm{\termm^\expr_2}{\selection_2}
    }{
      \flattenTerm{\term{\sbinhole{\termm^\expr_1}{\termm^\expr_2}}}{\selection_1~\sbintile{\binhole}~\selection_2}
    }\hspace{20pt}
    \inferrule[]{
      \flattenTerm{\termm^\expr_1}{\selection_1} \\
      \flattenTerm{\termm^\expr_2}{\selection_2}
    }{
      \flattenTerm{\term{\sprod{\termm^\expr_1}{\termm^\expr_2}}}{\selection_1~\sbintile{\tprod}~\selection_2}
    }\\
    \inferrule[]{
      \flattenTerm{\termm^\pat}{\tiles^{\pat}} \\
      \flattenTerm{\termm^\expr}{\selection}
    }{
      \flattenTerm{\term{\slam{\termm^\pat}{\termm^\expr}}}{\spretile{\tlam{\tiles^{\pat}}}~\selection}
    }\\
    \inferrule[]{
      \flattenTerm{\termm^\pat}{\tiles^{\pat}} \\
      \flattenTerm{\termm^\expr_1}{\tiles^{\expr}} \\
      \flattenTerm{\termm^\expr_2}{\selection}
    }{
      \flattenTerm{\term{\slet{\termm^\pat}{\termm^\expr_1}{\termm^\expr_2}}}{\spretile{\tlet{\tiles^{\pat}}{\tiles^{\expr}}}~\selection}
    }
  \end{mathpar}

  \caption{
    Term flattening
  }
  \label{fig:flatten-term}
  \end{figure}