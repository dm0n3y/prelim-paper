\begin{figure}
  \judgbox{\flattenTerm{p}{\tiles^{\pat}}}{$p$ flattens to $\tiles^{\pat}$}
  \begin{mathpar}
    \inferrule[]{
    }{
      \flattenTerm{\term{\ophole}}{\optile{\ophole}}
    }\hspace{20pt}
    \inferrule[]{
    }{
      \flattenTerm{\term{\svar{x}}}{\optile{\svar{x}}}
    }\hspace{20pt}
    \inferrule[]{
      \flattenTerm{p}{\tiles^{\pat}}
    }{
      \flattenTerm{\term{\sparen{p}}}{\optile{\sparen{\tiles^{\pat}}}}
    }\\
    \inferrule[]{
      \flattenTerm{p_1}{\tiles^{\pat}_1} \\
      \flattenTerm{p_2}{\tiles^{\pat}_2}
    }{
      \flattenTerm{\term{\sbinhole{p_1}{p_2}}}{\tiles^{\pat}_1~\bintile{\binhole}~\tiles^{\pat}_2}
    }\hspace{20pt}
    \inferrule[]{
      \flattenTerm{p_1}{\tiles^{\pat}_1} \\
      \flattenTerm{p_2}{\tiles^{\pat}_2}
    }{
      \flattenTerm{\term{\sprod{p_1}{p_2}}}{\tiles^{\pat}_1~\bintile{\tprod}~\tiles^{\pat}_2}
    }
  \end{mathpar}

  \vspace{10pt}
  \judgbox{\flattenTerm{e}{\tiles^{\expr}}}{$e$ flattens to $\tiles^{\expr}$}
  \begin{mathpar}
    \inferrule[]{
    }{
      \flattenTerm{\term{\ophole}}{\optile{\ophole}}
    }\hspace{15pt}
    \inferrule[]{
    }{
      \flattenTerm{\term{\snumlit{n}}}{\optile{\snumlit{n}}}
    }\hspace{15pt}
    \inferrule[]{
    }{
      \flattenTerm{\term{\svar{x}}}{\optile{\svar{x}}}
    }\hspace{15pt}
    \inferrule[]{
      \flattenTerm{e}{\tiles^{\expr}}
    }{
      \flattenTerm{\term{\sparen{e}}}{\optile{\sparen{\tiles^{\expr}}}}
    }\\
    \inferrule[]{
      \flattenTerm{e_1}{\tiles^{\expr}_1} \\
      \flattenTerm{e_2}{\tiles^{\expr}_2}
    }{
      \flattenTerm{\term{\sbinhole{e_1}{e_2}}}{\tiles^{\expr}_1~\bintile{\binhole}~\tiles^{\expr}_2}
    }\hspace{20pt}
    \inferrule[]{
      \flattenTerm{e_1}{\tiles^{\expr}_1} \\
      \flattenTerm{e_2}{\tiles^{\expr}_2}
    }{
      \flattenTerm{\term{\sprod{e_1}{e_2}}}{\tiles^{\expr}_1~\bintile{\tprod}~\tiles^{\expr}_2}
    }\\
    \inferrule[]{
      \flattenTerm{p}{\tiles^{\pat}} \\
      \flattenTerm{e}{\tiles^{\expr}}
    }{
      \flattenTerm{\term{\slam{p}{e}}}{\pretile{\tlam{\tiles^{\pat}}}~\tiles^{\expr}}
    }\\
    \inferrule[]{
      \flattenTerm{p}{\tiles^{\pat}} \\
      \flattenTerm{e_1}{\tiles^{\expr}_1} \\
      \flattenTerm{e_2}{\tiles^{\expr}_2}
    }{
      \flattenTerm{\term{\slet{p}{e_1}{e_2}}}{\pretile{\tlet{\tiles^{\pat}}{\tiles^{\expr}_1}}~\tiles^{\expr}_2}
    }
  \end{mathpar}

  \caption{
    Term flattening
  }
  \label{fig:flatten-term}
  \end{figure}